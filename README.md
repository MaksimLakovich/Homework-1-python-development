# Проект по разработе виджета банковских операций клиента


## 1. Цель проекта:
Реализовать виджет, который отображает последние успешные банковские операции клиента


## 2. Описание модулей:

1. ***masks.py*** - содержит две функции:
   - Функция маскировки номера банковской карты `get_mask_card_number`.
   
        Функция принимает на вход номер карты и возвращает ее маску. Номер карты замаскирован и отображается в формате XXXX XX** **** XXXX , где X — это цифра номера.;
   - Функция маскировки номера банковского счета `get_mask_account`.
   
        Функция принимает на вход номер счета и возвращает его маску. Номер счета замаскирован и отображается в формате **XXXX , где X — это цифра номера.


2. ***widget.py*** - содержит две функции:
   - Функция `mask_account_card`, которая умеет обрабатывать информацию как о картах, так и о счетах.
   
        Функция:
     - Принимает один аргумент — строку, содержащую тип и номер карты или счета. Аргументом может быть строка типа Visa Platinum 7000792289606361, или Maestro 7000792289606361, или Счет 73654108430135874305. Разделять строку на 2 аргумента (отдельно имя, отдельно номер) нельзя!
     - Возвращает строку с замаскированным номером.
   - Функция`get_date`, которая принимает на вход строку с датой в формате "2024-03-11T02:26:18.671407" и возвращает строку с датой в формате "ДД.ММ.ГГГГ" ("11.03.2024").


3. ***processing.py*** - содержит две функции:
   - Функция `filter_by_state`, которая принимает список словарей и опционально значение для ключа state (по умолчанию 'EXECUTED'). Функция возвращает новый список словарей, содержащий только те словари, у которых ключ state соответствует указанному значению.
   - Функция`get_date`, которая принимает список словарей и необязательный параметр, задающий порядок сортировки (по умолчанию — убывание). Функция должна возвращать новый список, отсортированный по дате (date).


4. ***generators.py*** - содержит одну функцию и два генератора:
   - Функция `filter_by_currency`, которая принимает список словарей (данные о транзакциях) и возвращает итератор, который поочередно выдает транзакции с заданной валютой операции (например, USD).
   - Генератор `transaction_descriptions`, который принимает список словарей с транзакциями и возвращает описание каждой операции по очереди.
   - Генератор `card_number_generator`, который выдает номера банковских карт в формате XXXX XXXX XXXX XXXX, где X — цифра номера карты. Генератор может сгенерировать номера карт в заданном диапазоне от 0000 0000 0000 0001 до 9999 9999 9999 9999


5. ***decorators.py*** - в модуле реализован декоратор, который позволяет:
   - логировать работу функции и ее результат как в файл, так и в консоль;
   - декоратор может принимать необязательный аргумент `filename`, который определяет имя файла, в который будут записываться логи. Если filename не задан, то логи выводятся в консоль;
   - если вызов функции закончился ошибкой, записывается сообщение об ошибке и входные параметры функции.

    
6. ***utils.py*** - содержит функцию `get_transactions`, которая принимает на вход путь до JSON-файла и возвращает список словарей с данными о финансовых транзакциях.


7. ***external_api.py*** - содержит функцию `get_transaction_amount`, принимает на вход транзакцию и возвращает сумму транзакции (amount) в рублях. Если транзакция была в USD или EUR , происходит обращение к внешнему API для получения текущего курса валют и конвертации суммы операции в рубли. Для конвертации валюты используется **Exchange Rates Data API**.
    - `Описание токенов доступа для API`: описание переменных окружения ***.env*** и то, как они должны быть организованы описано в шаблоне ***.env.example***.


8. ***reading_files.py*** - содержит 2 функции для чтения транзакций в файлах с CSV-данными и EXCEL. Функции принимают на вход путь до файлов (csv или excel) и возвращают список словарей с данными о финансовых транзакциях:
   - Функция `get_transactions_from_csv` - обрабатывает файлы с CSV данными;
   - Функция `get_transactions_from_excel` - обрабатывает файлы с EXCEL данными.


## 3. Установка проекта:
1. Клонируйте репозиторий:
```
git clone https://github.com/MaksimLakovich/Homework-python-development
```

2. Установите зависимости:
```
poetry install
```


## 4. Модульное тестирование:

1. Тесты подготовлены отдельными файлами под каждый модуль функционала:
   - _test_modul_masks.py_
   - _test_modul_widget.py_
   - _test_modul_processing.py_
   - _test_modul_generators.py_
   - _test_modul_decorators.py_
   - _test_modul_utils.py_
   - _test_modul_external_api.py_
   - _test_modul_reading_files.py_
2. Для повышения качества тестирования используются фикстуры (файл: conftest.py) и параметризация тестов.

### Запуск тестирования:
1. Установить `pytest` в группу dev через Poetry:
```
poetry add --group dev pytest
```
2. Запустить выполнение тестов:
```
pytest -v
```

### Анализ покрытия кода тестами:
1. Установить `pytest-cov` в группу dev через Poetry:
```
poetry add --group dev pytest-cov
```
2. Запустить выполнение тестов:
```
pytest --cov=tests
```


## 5. Логирование модулей:

1. Реализована запись логов в файл для следующих модулей проекта:
   - модуль `masks.py`;
   - модуль `utils.py`;
   - модуль `reading_files.py`.
2. Логи записываются в папку ***logs*** в корне проекта;
3. Формат записи лога в файл включает метку времени, название модуля, уровень серьезности и сообщение, описывающее событие или ошибку, которые произошли; 
4. Лог перезаписывается при каждом запуске приложения.